<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>无限弹窗示例</title>
<style>
  :root{
    --bg:#ffdfee;
    --win-bg: rgba(255,255,255,0.95);
    --accent:#ffb6d5;
    --shadow: 0 20px 40px rgba(200,100,140,0.12);
    --radius:14px;
    --font: "Helvetica Neue", Arial, "PingFang SC", "Noto Sans CJK SC", sans-serif;
  }
  html,body{
    height:100%;
    margin:0;
    background: linear-gradient(180deg,#ffeef6 0%, #ffdfe6 100%);
    font-family:var(--font);
    overflow:hidden;
  }

  /* 控制按钮 */
  .controls{
    position:fixed;
    left:12px;
    top:12px;
    z-index:99999;
    display:flex;
    gap:8px;
  }
  .btn{
    background:var(--accent);
    border:none;
    padding:8px 12px;
    border-radius:999px;
    cursor:pointer;
    box-shadow:var(--shadow);
    font-weight:600;
  }

  /* 弹窗样式 */
  .window {
    position:fixed;
    width:320px;
    min-height:64px;
    border-radius:var(--radius);
    background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(255,248,250,0.95));
    box-shadow: var(--shadow);
    overflow:hidden;
    transform-origin:center center;
    z-index: 1000;
    will-change: transform, opacity, left, top;
    pointer-events:auto;
  }
  .win-head{
    height:28px;
    display:flex;
    align-items:center;
    gap:8px;
    padding:6px 10px;
    background: linear-gradient(90deg,#ffd3e8,#ffb6d5);
    color:#fff;
  }
  .dots {
    display:flex;
    gap:6px;
    align-items:center;
  }
  .dot{
    width:12px;height:12px;border-radius:50%;
    box-shadow: 0 1px 0 rgba(255,255,255,0.12) inset;
  }
  .dot.red{background:#ff7b9a}
  .dot.yellow{background:#ffd36f}
  .dot.green{background:#8ee2a0}

  .win-body{
    padding:14px 16px;
    font-size:18px;
    color:#b02b58;
    text-align:center;
    line-height:1.3;
  }

  /* 进入 / 退出 动画 */
  .pop-enter{
    animation: popIn 420ms cubic-bezier(.2,.9,.3,1);
  }
  @keyframes popIn {
    0%{ transform: translateY(18px) scale(.85) rotate(-2deg); opacity:0 }
    60%{ transform: translateY(-6px) scale(1.03) rotate(1deg); opacity:1 }
    100%{ transform: translateY(0) scale(1) rotate(0) }
  }
  .pop-exit{
    animation: popOut 420ms ease forwards;
  }
  @keyframes popOut {
    to { transform: translateY(30px) scale(.6); opacity:0 }
  }

  /* 点击移除提示 */
  .hint{
    position:fixed;
    right:12px; bottom:12px;
    background:rgba(255,255,255,0.85);
    padding:8px 12px;border-radius:999px; box-shadow:var(--shadow);
    color:#c84a7a;font-weight:600; z-index:99999;
  }

  /* 小屏幕自适应 */
  @media (max-width:520px){
    .win-body{ font-size:14px; padding:10px 12px; }
  }
</style>
</head>
<body>
  <div class="controls">
    <button id="toggleBtn" class="btn">停止</button>
    <button id="clearBtn" class="btn">清空</button>
    <label style="align-self:center;color:#b02b58;font-weight:600;margin-left:4px;">速率:</label>
    <input id="rate" type="range" min="50" max="2000" step="10" value="300" style="width:160px; margin-left:6px;">
  </div>

  <div class="hint">点击任意弹窗可移除它</div>

<script>
/* ========== 配置 ========== */
const messages = [
  "廖倩奕~你是我心里最软的一角(｡>﹏<｡)♡",
  "有你在的每一天，都是小甜心日～(づ｡◕‿‿◕｡)づ",
  "廖倩奕，我的心被你可爱到融化啦～(❁´◡`❁)",
  "想你的时候，星星都在眨眼睛 ✩°｡⋆⸜(ू｡•ω•｡)",
  "廖倩奕，我最喜欢你笑的样子，比糖还甜～(๑˘︶˘๑)♡",
  "就算全世界都下雨☔，我也想为你撑伞～",
  "遇见你，是我最幸运的事情ฅ(♡ơ ₃ơ)ฅ",
  "廖倩奕~我爱你到连代码都在冒粉色的泡泡₍˶ᵔ ᵕ ᵔ˶₎♡",
  "心里装的不是代码，是你呀(〃∀〃)~♡",
  "每次看到‘廖倩奕’这三个字，我的世界都亮了～✨"
];

let running = true;            // 是否继续生成
let spawnRate = +document.getElementById('rate').value; // 毫秒
const maxPopups = 200;         // 保持页面不会无限占内存（可改或设为 Infinity）

/* ========== 工具函数 ========== */
function rand(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }
function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

/* 管理弹窗 */
const popups = [];

/* 生成一个弹窗 */
function createPopup(){
  // DOM
  const win = document.createElement('div');
  win.className = 'window pop-enter';
  const width = rand(220,420);
  const height = rand(64,140);
  win.style.width = width + 'px';

  // 随机位置（尽量在可视窗口内）
  const x = rand(8, Math.max(8, window.innerWidth - width - 8));
  const y = rand(8, Math.max(8, window.innerHeight - height - 8));
  win.style.left = x + 'px';
  win.style.top = y + 'px';

  // 内容
  win.innerHTML = `
    <div class="win-head">
      <div class="dots">
        <div class="dot red"></div>
        <div class="dot yellow"></div>
        <div class="dot green"></div>
      </div>
    </div>
    <div class="win-body">${pick(messages)}</div>
  `;

  // 点击就移除
  win.addEventListener('click', () => removePopup(win));

  // 轻微浮动效果（随机小位移循环）
  const floatAmp = rand(4, 14);
  let floatDir = Math.random() > 0.5 ? 1 : -1;
  let floatOffset = Math.random()*10;
  const floatId = setInterval(() => {
    floatOffset += 0.02*floatDir;
    if (Math.abs(floatOffset) > floatAmp/10) floatDir *= -1;
    win.style.transform = `translateY(${floatOffset}px)`;
  }, 40);

  // 鼠标按下可拖拽（更真实）
  makeDraggable(win);

  document.body.appendChild(win);
  popups.push({el:win, floatId});

  // 自动清理（避免内存爆炸）
  if (popups.length > maxPopups) {
    const oldest = popups.shift();
    removePopup(oldest.el);
  }
}

/* 移除弹窗（带动画）*/
function removePopup(el){
  if (!el) return;
  // 避免重复调用
  if (el._removing) return;
  el._removing = true;
  el.classList.remove('pop-enter');
  el.classList.add('pop-exit');
  // 清理 float interval（如果有）
  const idx = popups.findIndex(p=>p.el===el);
  if (idx>=0){
    const p = popups[idx];
    if (p.floatId) clearInterval(p.floatId);
    popups.splice(idx,1);
  }
  setTimeout(()=>{ try{ el.remove(); }catch(e){} }, 420);
}

/* 拖拽实现（简单）*/
function makeDraggable(el){
  let down = false, startX=0, startY=0, origX=0, origY=0;
  el.addEventListener('pointerdown', e => {
    down = true;
    el.setPointerCapture(e.pointerId);
    startX = e.clientX; startY = e.clientY;
    origX = parseFloat(el.style.left); origY = parseFloat(el.style.top);
    el.style.transition = 'none';
  });
  window.addEventListener('pointermove', e => {
    if (!down) return;
    const nx = origX + (e.clientX - startX);
    const ny = origY + (e.clientY - startY);
    el.style.left = Math.max(4, Math.min(window.innerWidth - el.offsetWidth - 4, nx)) + 'px';
    el.style.top  = Math.max(4, Math.min(window.innerHeight - el.offsetHeight - 4, ny)) + 'px';
  });
  window.addEventListener('pointerup', e => {
    if (!down) return;
    down = false;
    try{ el.releasePointerCapture(e.pointerId); }catch(e){}
    el.style.transition = '';
  });
}

/* 主循环：循环生成 */
let ticker = null;
function startSpawning(){
  if (ticker) clearInterval(ticker);
  ticker = setInterval(()=> {
    if (!running) return;
    createPopup();
  }, spawnRate);
}
startSpawning();

/* 控件交互 */
const toggleBtn = document.getElementById('toggleBtn');
const clearBtn = document.getElementById('clearBtn');
const rateInput = document.getElementById('rate');

toggleBtn.addEventListener('click', () => {
  running = !running;
  toggleBtn.textContent = running ? '停止' : '继续';
});

clearBtn.addEventListener('click', () => {
  // 清空所有现有弹窗
  while(popups.length) removePopup(popups[0].el);
});

rateInput.addEventListener('input', (e) => {
  spawnRate = +e.target.value;
  // 重启间隔
  startSpawning();
});

/* 当窗口大小变化，确保弹窗仍在可视范围内 */
window.addEventListener('resize', () => {
  popups.forEach(p => {
    if (!p.el) return;
    const el = p.el;
    const left = parseFloat(el.style.left);
    const top  = parseFloat(el.style.top);
    const maxLeft = Math.max(4, window.innerWidth - el.offsetWidth - 4);
    const maxTop  = Math.max(4, window.innerHeight - el.offsetHeight - 4);
    if (left > maxLeft) el.style.left = maxLeft + 'px';
    if (top > maxTop) el.style.top = maxTop + 'px';
  });
});

/* 开始时生成一些初始弹窗 */
for (let i=0;i<8;i++){ setTimeout(createPopup, i*80); }
</script>
</body>
</html>
